<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘çš„å·¥å…·ç®±</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 20px;
      text-align: center;
    }
    button {
      display: block;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin: 10px 0;
    }
    .section {
      display: none;
      background: #fff;
      padding: 15px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    .back-btn {
      margin-top: 10px;
    }
    /* æ‰ç‡è®¡ç®—å™¨ç‰¹æœ‰æ ·å¼ */
    .drop-container { background: #f5f5f5; padding: 20px; border-radius: 8px; }
    .drop-result { margin-top: 20px; padding: 15px; background: #e9f7ef; border-radius: 4px; }
    .drop-hidden { display: none; }
    .drop-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    .drop-table th, .drop-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .drop-table th { background-color: #f2f2f2; }
    .char-input { margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>æˆ‘çš„å·¥å…·ç®±</h1>

  <button onclick="showSection('gacha')">ğŸ® æŠ½å¡æ¨¡æ‹Ÿå™¨</button>
  <button onclick="showSection('random')">ğŸ² éšæœºæ•°ç”Ÿæˆ</button>
  <button onclick="showSection('currency')">ğŸ’± æ±‡ç‡è®¡ç®—å™¨</button>
  <button onclick="showSection('stamina')">ğŸ”‹ æ¸¸æˆä½“åŠ›</button>
  <button onclick="showSection('calculator')">ğŸ§® ç§‘å­¦è®¡ç®—å™¨</button>
  <button onclick="showSection('drop')">ğŸ“‰ æ‰ç‡è®¡ç®—</button>
  <button onclick="showSection('ledger')">ğŸ“” è®°è´¦æœ¬</button>
  <button onclick="showSection('daily-gems')">ğŸ“Š æ¯æ—¥æŠ½å¡çŸ³è®°å½•</button>

  <!-- æŠ½å¡æ¨¡æ‹Ÿå™¨åŒºåŸŸ -->
  <div id="gacha" class="section">
    <h2>æŠ½å¡æ¨¡æ‹Ÿå™¨</h2>
    <!-- åœ¨è¿™é‡Œæ”¾å…¥ä½ çš„æŠ½å¡æ¨¡æ‹Ÿå™¨ä»£ç  -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æŠ½å¡æ¨¡æ‹Ÿå™¨</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    h1 {
      font-size: 1.5em;
    }
    input {
      width: 60px;
    }
    button {
      margin: 10px 0;
      padding: 8px 16px;
      font-size: 1em;
    }
    .history {
      border-top: 1px solid #ccc;
      margin-top: 20px;
      padding-top: 10px;
    }
    .entry {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ® æŠ½å¡æ¨¡æ‹Ÿå™¨ï¼ˆè§’è‰² + ç»˜å·ï¼‰</h1>

  <label>è§’è‰²æ¦‚ç‡ï¼ˆ%ï¼‰ï¼š
    <input type="number" id="charRate" value="0.5" step="0.1">
  </label>
  <label>ç»˜å·æ¦‚ç‡ï¼ˆ%ï¼‰ï¼š
    <input type="number" id="scrollRate" value="1.5" step="0.1">
  </label>
  <label>ç›®æ ‡è§’è‰²æ¦‚ç‡ï¼ˆ%ï¼‰ï¼š
    <input type="number" id="targetCharRate" value="0" step="0.1">
  </label>
  <label>ç›®æ ‡ç»˜å·æ¦‚ç‡ï¼ˆ%ï¼‰ï¼š
    <input type="number" id="targetScrollRate" value="0" step="0.1">
  </label>
  <br><br>

  <button onclick="drawTen()">âœ¨ 10è¿æŠ½</button>
  <button onclick="clearHistory()">ğŸ—‘ï¸ æ¸…é™¤è®°å½•</button>

  <p id="summary">å·²æŠ½ï¼š0 æŠ½ ï½œè§’è‰²ï¼š0 ä¸ª ï½œç»˜å·ï¼š0 ä¸ª</p>

  <div class="history" id="history"></div>

  <script>
    let drawCount = 0;
    let charCount = 0;
    let scrollCount = 0;
    let drawTimes = 0;

    function drawTen() {
      const charRate = parseFloat(document.getElementById('charRate').value) / 100;
      const scrollRate = parseFloat(document.getElementById('scrollRate').value) / 100;
      const targetCharRate = parseFloat(document.getElementById('targetCharRate').value) / 100;
      const targetScrollRate = parseFloat(document.getElementById('targetScrollRate').value) / 100;
      const totalRate = charRate + scrollRate;

      if (targetCharRate > charRate || targetScrollRate > scrollRate) {
        alert("ç›®æ ‡æ¦‚ç‡ä¸èƒ½å¤§äºæ€»æ¦‚ç‡ï¼");
        return;
      }

      const historyDiv = document.getElementById("history");

      let results = [];
      let localChar = 0, localScroll = 0;

      for (let i = 0; i < 10; i++) {
        const roll = Math.random();
        if (roll < charRate) {
          const targetRoll = Math.random();
          if (targetCharRate === 0 || targetRoll < targetCharRate / charRate) {
            results.push("ğŸ¯ ä¸­");
          } else {
            results.push("ğŸ¯ æ­ª");
          }
          charCount++;
          localChar++;
        } else if (roll < charRate + scrollRate) {
          const targetRoll = Math.random();
          if (targetScrollRate === 0 || targetRoll < targetScrollRate / scrollRate) {
            results.push("ğŸ“œ ä¸­");
          } else {
            results.push("ğŸ“œ æ­ª");
          }
          scrollCount++;
          localScroll++;
        } else {
          results.push("â€”");
        }
      }

      drawCount += 10;
      drawTimes++;

      const resultText = results.join(" ï½œ ");
      const entry = document.createElement("div");
      entry.className = "entry";
      entry.textContent = `ç¬¬ ${drawTimes} æ¬¡10è¿ï¼š${resultText}`;
      historyDiv.prepend(entry);

      updateSummary();
    }

    function updateSummary() {
      const summary = document.getElementById("summary");
      summary.textContent = `å·²æŠ½ï¼š${drawCount} æŠ½ ï½œè§’è‰²ï¼š${charCount} ä¸ª ï½œç»˜å·ï¼š${scrollCount} ä¸ª`;
    }

    function clearHistory() {
      document.getElementById("history").innerHTML = "";
      drawCount = 0;
      charCount = 0;
      scrollCount = 0;
      drawTimes = 0;
      updateSummary();
    }
  </script>
</body>
</html>
    <button class="back-btn" onclick="goHome()">è¿”å›ä¸»é¡µ</button>
  </div>

  <!-- éšæœºæ•°ç”ŸæˆåŒºåŸŸ -->
  <div id="random" class="section">
    <h2>éšæœºæ•°ç”Ÿæˆ</h2>
    <!-- åœ¨è¿™é‡Œæ”¾å…¥ä½ çš„éšæœºæ•°ç”Ÿæˆä»£ç  -->
<!DOCTYPE html>
<html>
<head>
    <title>éšæœºæ•°ç”Ÿæˆå™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: inline-block;
            width: 120px;
        }
        input, select {
            padding: 5px;
            width: 100px;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #result {
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>éšæœºæ•°ç”Ÿæˆå™¨</h2>
        <div class="form-group">
            <label for="min">æœ€å°å€¼:</label>
            <input type="number" id="min" value="0">
        </div>
        <div class="form-group">
            <label for="max">æœ€å¤§å€¼:</label>
            <input type="number" id="max" value="100">
        </div>
        <div class="form-group">
            <label for="decimal">å…è®¸å°æ•°:</label>
            <input type="checkbox" id="decimal" onchange="toggleDecimal()">
        </div>
        <div class="form-group" id="decimalDigitsGroup" style="display:none;">
            <label for="digits">å°æ•°ä½æ•°:</label>
            <select id="digits">
                <option value="1">1ä½</option>
                <option value="2" selected>2ä½</option>
                <option value="3">3ä½</option>
                <option value="4">4ä½</option>
            </select>
        </div>
        <button onclick="generateRandom()">ç”Ÿæˆéšæœºæ•°</button>
        <div id="result"></div>
    </div>

    <script>
        function toggleDecimal() {
            const decimalCheckbox = document.getElementById('decimal');
            const decimalDigitsGroup = document.getElementById('decimalDigitsGroup');
            decimalDigitsGroup.style.display = decimalCheckbox.checked ? 'block' : 'none';
        }

        function generateRandom() {
            const min = parseFloat(document.getElementById('min').value);
            const max = parseFloat(document.getElementById('max').value);
            const allowDecimal = document.getElementById('decimal').checked;
            const digits = parseInt(document.getElementById('digits').value);
            
            if (min >= max) {
                alert('æœ€å¤§å€¼å¿…é¡»å¤§äºæœ€å°å€¼');
                return;
            }

            let randomNum;
            if (allowDecimal) {
                randomNum = Math.random() * (max - min) + min;
                randomNum = parseFloat(randomNum.toFixed(digits));
            } else {
                randomNum = Math.floor(Math.random() * (max - min + 1)) + min;
            }

            document.getElementById('result').textContent = randomNum;
        }
    </script>
</body>
</html>
    <button class="back-btn" onclick="goHome()">è¿”å›ä¸»é¡µ</button>
  </div>

  <!-- æ±‡ç‡è®¡ç®—å™¨åŒºåŸŸ -->
  <div id="currency" class="section">
    <h2>æ±‡ç‡è®¡ç®—å™¨</h2>
    <!-- åœ¨è¿™é‡Œæ”¾å…¥ä½ çš„æ±‡ç‡è®¡ç®—å™¨ä»£ç  -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ±‡ç‡è½¬æ¢å™¨</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    label {
      display: block;
      margin-top: 12px;
    }
    input {
      width: 100px;
      padding: 5px;
      margin-left: 8px;
    }
    button {
      margin-top: 16px;
      padding: 8px 16px;
      font-size: 16px;
    }
    #tip {
      color: gray;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸ’± æ±‡ç‡è½¬æ¢å™¨</h1>

  <label>
    äººæ°‘å¸ 1 = 
    <input id="rateRMB" type="number" step="0.0001">
    å¤–å¸
  </label>

  <label>
    å¤–å¸ 1 = 
    <input id="rateForeign" type="number" step="0.0001">
    äººæ°‘å¸
  </label>

  <hr>

  <label>
    äººæ°‘å¸é‡‘é¢ï¼š
    <input id="inputRMB" type="number">
  </label>

  <label>
    å¤–å¸é‡‘é¢ï¼š
    <input id="inputForeign" type="number">
  </label>

  <button onclick="convertAmount()">âœ¨ è½¬æ¢é‡‘é¢</button>

  <p id="tip"></p>

  <script>
    let rate = 0;
    let lastInput = null; // è®°å½•æœ€è¿‘è¾“å…¥å“ªä¸€æ–¹ï¼ˆ'rmb' æˆ– 'foreign'ï¼‰

    const rateRMBInput = document.getElementById('rateRMB');
    const rateForeignInput = document.getElementById('rateForeign');
    const rmbInput = document.getElementById('inputRMB');
    const foreignInput = document.getElementById('inputForeign');

    function updateFromRMBRate() {
      const rmbRate = parseFloat(rateRMBInput.value);
      if (!isNaN(rmbRate) && rmbRate > 0) {
        rate = rmbRate;
        rateForeignInput.value = (1 / rate).toFixed(6);
        saveRate(rate);
        showTip();
      }
    }

    function updateFromForeignRate() {
      const foreignRate = parseFloat(rateForeignInput.value);
      if (!isNaN(foreignRate) && foreignRate > 0) {
        rate = 1 / foreignRate;
        rateRMBInput.value = rate.toFixed(6);
        saveRate(rate);
        showTip();
      }
    }

    function saveRate(rate) {
      localStorage.setItem("exchangeRate", rate.toString());
    }

    function showTip() {
      document.getElementById("tip").textContent = `å½“å‰æ±‡ç‡ï¼š1 äººæ°‘å¸ = ${rate.toFixed(4)} å¤–å¸`;
    }

    rateRMBInput.addEventListener('input', updateFromRMBRate);
    rateForeignInput.addEventListener('input', updateFromForeignRate);

    rmbInput.addEventListener('input', () => { lastInput = 'rmb'; });
    foreignInput.addEventListener('input', () => { lastInput = 'foreign'; });

    function convertAmount() {
      if (!rate || rate <= 0) {
        alert("è¯·å…ˆè®¾ç½®æœ‰æ•ˆæ±‡ç‡");
        return;
      }

      if (lastInput === 'rmb') {
        const rmbVal = parseFloat(rmbInput.value);
        if (!isNaN(rmbVal)) {
          foreignInput.value = (rmbVal * rate).toFixed(4);
        }
      } else if (lastInput === 'foreign') {
        const foreignVal = parseFloat(foreignInput.value);
        if (!isNaN(foreignVal)) {
          rmbInput.value = (foreignVal / rate).toFixed(4);
        }
      } else {
        alert("è¯·å…ˆè¾“å…¥ä¸€ä¸ªé‡‘é¢å†ç‚¹å‡»è½¬æ¢");
      }
    }

    // é¡µé¢åŠ è½½æ—¶æ¢å¤ä¿å­˜çš„æ±‡ç‡
    function loadExchangeRate() {
      const savedRate = parseFloat(localStorage.getItem("exchangeRate"));
      if (!isNaN(savedRate) && savedRate > 0) {
        rate = savedRate;
        rateRMBInput.value = rate.toFixed(6);
        rateForeignInput.value = (1 / rate).toFixed(6);
        showTip();
      }
    }

    window.onload = loadExchangeRate;
  </script>
</body>
</html>
    <button class="back-btn" onclick="goHome()">è¿”å›ä¸»é¡µ</button>
  </div>

  <!-- æ¸¸æˆä½“åŠ›åŒºåŸŸ -->
  <div id="stamina" class="section">
    <h2>æ¸¸æˆä½“åŠ›è®¡ç®—</h2>
    <!-- åœ¨è¿™é‡Œæ”¾å…¥ä½ çš„æ¸¸æˆä½“åŠ›è®¡ç®—ä»£ç  -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ¸¸æˆä½“åŠ›è®¡ç®—å™¨</title>
  <style>
    body { font-family: 'Arial', sans-serif; background-color: #f5f7fa; margin: 0; padding: 20px; }
    .dashboard { background: #2196F3; color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .stamina-display { font-size: 28px; font-weight: bold; margin-bottom: 15px; }
    .stamina-value { color: #FFEB3B; font-size: 36px; }
    .info-row { display: flex; justify-content: space-between; margin: 8px 0; font-size: 16px; }
    .time-value { font-weight: bold; }
    .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 500px; margin: 0 auto; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input, button { padding: 10px 15px; width: 100%; box-sizing: border-box; border-radius: 5px; border: 1px solid #ddd; }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; margin-top: 10px; font-weight: bold; }
    button.secondary { background: #f44336; }
    .history { margin-top: 20px; max-height: 200px; overflow-y: auto; border-top: 1px solid #eee; padding-top: 15px; }
    .history-item { padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; }
    .progress-container { height: 8px; background: #e0e0e0; border-radius: 4px; margin: 15px 0; overflow: hidden; }
    .progress-bar { height: 100%; background: #FFC107; width: 0%; transition: width 0.5s ease; }
  </style>
</head>
<body>
  <div class="container">
    <div class="dashboard">
      <div class="stamina-display">
        å½“å‰ä½“åŠ›: <span class="stamina-value" id="current-stamina-display">100</span>/100
      </div>
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="info-row">
        <span>å½“å‰æ—¶é—´:</span>
        <span class="time-value" id="current-time">--:--</span>
      </div>
      <div class="info-row">
        <span>ä¸‹æ¬¡æ¢å¤:</span>
        <span class="time-value" id="next-recovery">--:--</span>
      </div>
      <div class="info-row">
        <span>å®Œå…¨æ¢å¤:</span>
        <span class="time-value" id="full-recovery">--:--</span>
      </div>
    </div>

    <div class="form-group">
      <label for="input-stamina">è®¾ç½®å½“å‰ä½“åŠ› (0-100):</label>
      <input type="number" id="input-stamina" min="0" max="100" value="100" />
    </div>

    <div class="form-group">
      <label for="input-consume">æ¶ˆè€—ä½“åŠ›:</label>
      <input type="number" id="input-consume" min="0" value="0" />
    </div>

    <button id="update-btn">æ›´æ–°ä½“åŠ›</button>
    <button id="consume-btn">æ¶ˆè€—ä½“åŠ›</button>
    <button class="secondary" id="clear-btn">æ¸…é™¤å†å²è®°å½•</button>

    <div class="history">
      <h3>æ“ä½œå†å²</h3>
      <div id="history-list"></div>
    </div>
  </div>

  <script>
    class StaminaCalculator {
      constructor() {
        this.data = {
          current: 100,
          max: 100,
          recoveryRate: 10, // æ¯æ¢å¤1ç‚¹æ‰€éœ€åˆ†é’Ÿæ•°
          lastUpdate: Date.now(),
          history: []
        };

        this.initElements();
        this.loadData();
        this.setupEventListeners();
        this.startTimers();
        this.updateDisplay();
      }

      initElements() {
        this.elements = {
          staminaDisplay: document.getElementById('current-stamina-display'),
          inputStamina: document.getElementById('input-stamina'),
          inputConsume: document.getElementById('input-consume'),
          progressBar: document.getElementById('progress-bar'),
          currentTime: document.getElementById('current-time'),
          nextRecovery: document.getElementById('next-recovery'),
          fullRecovery: document.getElementById('full-recovery'),
          historyList: document.getElementById('history-list')
        };
      }

      setupEventListeners() {
        document.getElementById('update-btn').addEventListener('click', () => this.updateStamina());
        document.getElementById('consume-btn').addEventListener('click', () => this.consumeStamina());
        document.getElementById('clear-btn').addEventListener('click', () => this.clearHistory());
      }

      startTimers() {
        setInterval(() => this.updateClock(), 1000);
        setInterval(() => this.updateStaminaByTime(), 1000);
      }

      loadData() {
        const saved = localStorage.getItem('staminaData');
        if (saved) {
          const data = JSON.parse(saved);
          this.data.current = data.current;
          this.data.lastUpdate = data.lastUpdate;
          this.data.history = data.history || [];
          this.calculateOfflineRecovery();
        }
      }

      saveData() {
        localStorage.setItem('staminaData', JSON.stringify(this.data));
      }

      calculateOfflineRecovery() {
        const now = Date.now();
        const minutesPassed = Math.floor((now - this.data.lastUpdate) / 60000);
        const staminaRecovered = Math.floor(minutesPassed / this.data.recoveryRate);

        if (staminaRecovered > 0) {
          this.data.current = Math.min(this.data.max, this.data.current + staminaRecovered);
          this.data.lastUpdate = now - ((minutesPassed % this.data.recoveryRate) * 60000); // ä¿®æ­£åˆ°æœ€è¿‘ä¸€æ¬¡æ¢å¤ç‚¹
          this.addHistory(`ç¦»çº¿æ¢å¤ ${staminaRecovered} ç‚¹ä½“åŠ›`);
          this.saveData();
        }
      }


      updateClock() {
        const now = new Date();
        this.elements.currentTime.textContent = now.toTimeString().substring(0, 5);
      }

      updateDisplay() {
        const now = new Date();
        this.elements.staminaDisplay.textContent = this.data.current;
        this.elements.inputStamina.value = this.data.current;
        this.elements.progressBar.style.width = `${this.data.current}%`;
        this.updateRecoveryTimes(now);
        this.updateHistoryDisplay();
      }

      updateRecoveryTimes(now) {
        if (this.data.current < this.data.max) {
          const nextRecovery = new Date(this.data.lastUpdate + this.data.recoveryRate * 60000);
          const minsRemaining = Math.ceil((nextRecovery - now) / 60000);
          const minsToFull = (this.data.max - this.data.current) * this.data.recoveryRate;
          const fullRecovery = new Date(now.getTime() + minsToFull * 60000);

          this.elements.nextRecovery.textContent =
            `${nextRecovery.toTimeString().substring(0, 5)} (çº¦${minsRemaining}åˆ†é’Ÿ)`;
          this.elements.fullRecovery.textContent =
            `${fullRecovery.toTimeString().substring(0, 5)} (çº¦${minsToFull}åˆ†é’Ÿ)`;
        } else {
          this.elements.nextRecovery.textContent = "å·²æ»¡";
          this.elements.fullRecovery.textContent = "å·²æ»¡";
        }
      }

      updateStamina() {
        const newStamina = parseInt(this.elements.inputStamina.value);
        if (isNaN(newStamina) || newStamina < 0 || newStamina > this.data.max) {
          alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä½“åŠ›å€¼ (0-100)');
          return;
        }

        const oldStamina = this.data.current;
        this.data.current = newStamina;
        this.addHistory(`æ‰‹åŠ¨è®¾ç½®ä½“åŠ› ${oldStamina} â†’ ${newStamina}`);
        this.saveData();
        this.updateDisplay();
      }

      consumeStamina() {
        const consume = parseInt(this.elements.inputConsume.value);
        if (isNaN(consume) || consume < 0) {
          alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¶ˆè€—å€¼');
          return;
        }

        const oldStamina = this.data.current;
        this.data.current = Math.max(0, this.data.current - consume);
        this.addHistory(`æ¶ˆè€—ä½“åŠ› ${consume} ç‚¹ (${oldStamina} â†’ ${this.data.current})`);
        this.saveData();
        this.updateDisplay();
      }

      updateStaminaByTime() {
        const now = Date.now();
        const minutesPassed = (now - this.data.lastUpdate) / 60000;

        if (minutesPassed >= this.data.recoveryRate && this.data.current < this.data.max) {
          this.data.current = Math.min(this.data.max, this.data.current + 1);
          this.data.lastUpdate += this.data.recoveryRate * 60000;
          this.addHistory(`è‡ªåŠ¨æ¢å¤ 1 ç‚¹ä½“åŠ›`);
          this.saveData();
          this.updateDisplay();
        }
      }

      addHistory(text) {
        const now = new Date();
        this.data.history.unshift({ text, time: now.toLocaleTimeString() });
        if (this.data.history.length > 50) this.data.history.pop();
      }

      updateHistoryDisplay() {
        this.elements.historyList.innerHTML = '';
        this.data.history.forEach(item => {
          const div = document.createElement('div');
          div.className = 'history-item';
          div.textContent = `[${item.time}] ${item.text}`;
          this.elements.historyList.appendChild(div);
        });
      }

      clearHistory() {
        this.data.history = [];
        this.updateHistoryDisplay();
        this.saveData();
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      new StaminaCalculator();
    });
  </script>
</body>
</html>
    <button class="back-btn" onclick="goHome()">è¿”å›ä¸»é¡µ</button>
  </div>

  <!-- ç§‘å­¦è®¡ç®—å™¨åŒºåŸŸ -->
  <div id="calculator" class="section">
    <h2>ç§‘å­¦è®¡ç®—å™¨</h2>
    <!-- åœ¨è¿™é‡Œæ”¾å…¥ä½ çš„ç§‘å­¦è®¡ç®—å™¨ä»£ç  -->

<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç§‘å­¦è®¡ç®—å™¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 400px;
      margin: 40px auto;
      padding: 20px;
      background-color: #f0f0f0;
    }
    h2 {
      text-align: center;
    }
    input {
      width: 100%;
      font-size: 20px;
      padding: 10px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    button {
      padding: 15px;
      font-size: 18px;
      border: none;
      background-color: #2196F3;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #1976D2;
    }
    .wide {
      grid-column: span 2;
    }
    #calcResult {
      text-align: right;
      font-size: 18px;
      margin-top: 10px;
      color: #333;
    }
  </style>
</head>
<body>
  <h2>ç§‘å­¦è®¡ç®—å™¨</h2>
  <input type="text" id="calcExpression" placeholder="è¾“å…¥è¡¨è¾¾å¼ï¼Œå¦‚ 2^3 + sqrt(9) - 5!" />
  <div class="buttons">
    <button onclick="calcInsert('7')">7</button>
    <button onclick="calcInsert('8')">8</button>
    <button onclick="calcInsert('9')">9</button>
    <button onclick="calcInsert('/')">Ã·</button>

    <button onclick="calcInsert('4')">4</button>
    <button onclick="calcInsert('5')">5</button>
    <button onclick="calcInsert('6')">6</button>
    <button onclick="calcInsert('*')">Ã—</button>

    <button onclick="calcInsert('1')">1</button>
    <button onclick="calcInsert('2')">2</button>
    <button onclick="calcInsert('3')">3</button>
    <button onclick="calcInsert('-')">âˆ’</button>

    <button onclick="calcInsert('0')">0</button>
    <button onclick="calcInsert('.')">.</button>
    <button onclick="calcInsert('+')">+</button>
    <button onclick="calcInsert('^')">^</button>

    <button onclick="calcInsert('(')">(</button>
    <button onclick="calcInsert(')')">)</button>
    <button onclick="calcInsert('sqrt(')">âˆš</button>
    <button onclick="calcInsert('!')">!</button>

    <button class="wide" onclick="calcClearInput()">æ¸…é™¤</button>
    <button class="wide" onclick="calcCalculate()">= è®¡ç®—</button>
  </div>
  <div id="calcResult"></div>

<script>
  let lastResult = null; // ä¿å­˜ä¸Šæ¬¡è®¡ç®—ç»“æœ

  function calcInsert(value) {
    const input = document.getElementById("calcExpression");
    const current = input.value;

    if (current.includes('=')) {
      // å¦‚æœä¸Šä¸€æ¬¡æ˜¯è®¡ç®—ç»“æœ
      if (['+', '-', '*', '/', '^'].includes(value)) {
        // å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯è¿ç®—ç¬¦ï¼Œåˆ™ç»§ç»­ä½¿ç”¨ä¸Šä¸€æ¬¡çš„ç»“æœè®¡ç®—
        input.value = lastResult + value;
      } else {
        // å¦‚æœè¾“å…¥çš„æ˜¯æ•°å­—æˆ–å…¶ä»–ï¼Œè¡¨ç¤ºå¼€å§‹æ–°ä¸€è½®è¾“å…¥
        input.value = value;
      }
    } else {
      input.value += value;
    }
  }

  function calcClearInput() {
    document.getElementById("calcExpression").value = '';
    document.getElementById("calcResult").textContent = '';
    lastResult = null;
  }

  function calcCalculate() {
    let exprInput = document.getElementById("calcExpression").value;
    let exprEval = exprInput;

    try {
      exprEval = exprEval.replace(/\^/g, '**');
      exprEval = exprEval.replace(/sqrt\(/g, 'Math.sqrt(');
      exprEval = exprEval.replace(/âˆš/g, 'Math.sqrt');
      exprEval = exprEval.replace(/(\d+)!/g, (_, n) => calcFactorial(parseInt(n)));

      const result = eval(exprEval);

      lastResult = result; // ä¿å­˜ç»“æœä¾›åç»­ä½¿ç”¨
      document.getElementById("calcExpression").value = `${exprInput} = ${result}`;
      document.getElementById("calcResult").textContent = '';
    } catch (e) {
      document.getElementById("calcResult").textContent = 'é”™è¯¯: è¡¨è¾¾å¼æ— æ•ˆ';
    }
  }

  function calcFactorial(n) {
    if (n < 0) return NaN;
    if (n === 0 || n === 1) return 1;
    let res = 1;
    for (let i = 2; i <= n; i++) res *= i;
    return res;
  }
</script>

</body>
</html>

    <button class="back-btn" onclick="goHome()">è¿”å›ä¸»é¡µ</button>
  </div>

  <!-- æ‰ç‡è®¡ç®—åŒºåŸŸ -->
  <div id="drop" class="section">
    <h2>æ‰ç‡è®¡ç®—</h2>
    <div class="drop-container">
      <div>
        <label for="charCount">å‡ºæˆ˜è§’è‰²æ•°é‡ (1-6):</label>
        <input type="number" id="charCount" min="1" max="6" value="3">
      </div>
      
      <div id="charInputs"></div>
      
      <div>
        <h3>ç›®æ ‡æ‰è½æ•°é‡</h3>
        <label for="targetA">Aé“å…·æ•°é‡:</label>
        <input type="number" id="targetA" min="1" value="1">
        <label for="targetB">Bé“å…·æ•°é‡:</label>
        <input type="number" id="targetB" min="0" value="1">
      </div>
      
      <button onclick="calculateDropRate()">è®¡ç®—æ‰ç‡</button>
      
      <div id="dropResult" class="drop-result drop-hidden">
        <h3>è®¡ç®—ç»“æœ</h3>
        <div id="resultDetails"></div>
      </div>
    </div>
    <button class="back-btn" onclick="goHome()">è¿”å›ä¸»é¡µ</button>
  </div>

  <!-- è®°è´¦æœ¬åŒºåŸŸ -->
  <div id="ledger" class="section">
    <h2>è®°è´¦æœ¬</h2>
    <!-- åœ¨è¿™é‡Œæ”¾å…¥ä½ çš„è®°è´¦æœ¬ä»£ç  -->
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººè´¢åŠ¡è®°è´¦æœ¬</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
            color: #333;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        .summary {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            transition: transform 0.3s ease;
        }
        .summary:hover {
            transform: translateY(-3px);
        }
        .account {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }
        .account:hover {
            background-color: #f9f9f9;
        }
        .positive { 
            color: #27ae60;
            font-weight: bold;
        }
        .negative { 
            color: #e74c3c;
            font-weight: bold;
        }
        .total {
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #eee;
        }
        .panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }
        .panel:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 12px 0;
            user-select: none;
        }
        .panel-header h2 {
            margin: 0;
            color: #2c3e50;
        }
        .panel-content {
            display: none;
            padding-top: 20px;
        }
        .panel.active .panel-content {
            display: block;
        }
        input, select {
            padding: 10px;
            margin: 8px 0;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        button:active {
            transform: translateY(0);
        }
        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .btn-group button {
            flex: 1;
            min-width: 120px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        th {
            background-color: #3498db;
            color: white;
            text-align: left;
            padding: 14px;
        }
        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #eaf5ff;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        .input-row {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        .input-row > * {
            flex: 1;
        }
        .highlight {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .progress-container {
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: #3498db;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <header>
        <h1>ä¸ªäººè´¢åŠ¡è®°è´¦æœ¬</h1>
        <div class="subtitle">è½»æ¾ç®¡ç†æ‚¨çš„èµ„äº§ã€å€ºåŠ¡å’Œæ”¯å‡ºè®¡åˆ’</div>
    </header>
    
    <div class="summary">
        <h2>å½“å‰è´¢åŠ¡çŠ¶å†µ</h2>
        <div id="accounts-list"></div>
        <div class="progress-container">
            <div class="progress-bar" id="debt-progress"></div>
        </div>
        <div class="status-bar">
            <span>æ€»èµ„äº§</span>
            <span>æ€»è´Ÿå€º</span>
        </div>
        <div class="total">æ€»èµ„äº§: <span id="total-assets" class="positive">0.00</span> å…ƒ</div>
        <div class="total">æ€»è´Ÿå€º: <span id="total-debts" class="negative">0.00</span> å…ƒ</div>
        <div class="total">å‡€ä½™é¢: <span id="net-balance">0.00</span> å…ƒ</div>
    </div>

    <div class="panel" id="edit-panel">
        <div class="panel-header" onclick="togglePanel('edit-panel')">
            <h2>è´¦æˆ·é‡‘é¢è®¾ç½®</h2>
            <span>â–¼</span>
        </div>
        <div class="panel-content">
            <div class="form-group">
                <label for="account-select">é€‰æ‹©è´¦æˆ·:</label>
                <select id="account-select">
                    <option value="alipay">æ”¯ä»˜å®</option>
                    <option value="wechat">å¾®ä¿¡</option>
                    <option value="bank1">ä¸­è¡Œå¡1</option>
                    <option value="bank2">ä¸­è¡Œå¡2</option>
                    <option value="huabei">èŠ±å‘—</option>
                    <option value="meituan">ç¾å›¢æœˆä»˜</option>
                    <option value="ccb">å»ºè¡Œä¿¡ç”¨å¡</option>
                </select>
            </div>
            <div class="form-group">
                <label for="amount">é‡‘é¢ (å…ƒ):</label>
                <input type="number" id="amount" step="0.01" placeholder="è¾“å…¥é‡‘é¢">
            </div>
            <div class="btn-group">
                <button onclick="updateAccount()">æ›´æ–°é‡‘é¢</button>
                <button onclick="addToAccount()">å¢åŠ é‡‘é¢</button>
                <button onclick="subtractFromAccount()">å‡å°‘é‡‘é¢</button>
            </div>
        </div>
    </div>

    <div class="panel" id="installment-panel">
        <div class="panel-header" onclick="togglePanel('installment-panel')">
            <h2>åˆ†æœŸä»˜æ¬¾ç®¡ç†</h2>
            <span>â–¼</span>
        </div>
        <div class="panel-content">
            <div class="highlight">
                <div class="total">ä¸‹æœˆéœ€è¿˜ï¼š<span id="installment-monthly" class="negative">0.00</span> å…ƒ</div>
                <div class="total">æ€»å‰©ä½™è¿˜æ¬¾ï¼š<span id="installment-total" class="negative">0.00</span> å…ƒ</div>
            </div>
            <table id="installment-table">
                <thead>
                    <tr>
                        <th>åˆ†æœŸåç§°</th>
                        <th>æ¯æœˆé‡‘é¢</th>
                        <th>å‰©ä½™æœŸæ•°</th>
                        <th>æ€»é‡‘é¢</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="form-group">
                <label>æ·»åŠ æ–°åˆ†æœŸ</label>
                <div class="input-row">
                    <select id="installment-name">
                        <option value="">é€‰æ‹©åˆ†æœŸ</option>
                        <option value="åˆ†æœŸ1">åˆ†æœŸ1</option>
                        <option value="åˆ†æœŸ2">åˆ†æœŸ2</option>
                        <option value="åˆ†æœŸ3">åˆ†æœŸ3</option>
                        <option value="åˆ†æœŸ4">åˆ†æœŸ4</option>
                        <option value="åˆ†æœŸ5">åˆ†æœŸ5</option>
                    </select>
                    <input type="number" id="installment-amount" step="0.01" min="0" placeholder="æ¯æœˆé‡‘é¢">
                    <input type="number" id="installment-periods" min="1" placeholder="å‰©ä½™æœŸæ•°">
                </div>
                <button onclick="addInstallment()">æ·»åŠ åˆ†æœŸ</button>
            </div>
        </div>
    </div>

    <div class="panel" id="expense-panel">
        <div class="panel-header" onclick="togglePanel('expense-panel')">
            <h2>é¢„è®¡æ”¯å‡º</h2>
            <span>â–¼</span>
        </div>
        <div class="panel-content">
            <div class="form-group">
                <label for="expense-desc">æ”¯å‡ºæè¿°:</label>
                <input type="text" id="expense-desc" placeholder="ä¾‹å¦‚: æˆ¿ç§Ÿã€ä¿é™©è´¹ã€å­¦è´¹">
            </div>
            <div class="form-group">
                <label for="expense-amount">é‡‘é¢ (å…ƒ):</label>
                <input type="number" id="expense-amount" step="0.01" placeholder="è¾“å…¥é‡‘é¢">
            </div>
            <div class="form-group">
                <label for="expense-date">é¢„è®¡æ”¯å‡ºæ—¶é—´:</label>
                <input type="date" id="expense-date">
            </div>
            <button onclick="addExpense()">æ·»åŠ é¢„è®¡æ”¯å‡º</button>
            <table id="expenses-table">
                <thead>
                    <tr>
                        <th>æè¿°</th>
                        <th>é‡‘é¢</th>
                        <th>é¢„è®¡æ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <footer>
        <p>Â© 2023 ä¸ªäººè´¢åŠ¡è®°è´¦æœ¬ | æ•°æ®å­˜å‚¨åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°</p>
    </footer>

    <script>
        let accounts = {
            alipay: { name: "æ”¯ä»˜å®", balance: 1250.50, type: "+" },
            wechat: { name: "å¾®ä¿¡", balance: 580.25, type: "+" },
            bank1: { name: "ä¸­è¡Œå¡1", balance: 3500.00, type: "+" },
            bank2: { name: "ä¸­è¡Œå¡2", balance: 1200.75, type: "+" },
            huabei: { name: "èŠ±å‘—", balance: 850.00, type: "-" },
            meituan: { name: "ç¾å›¢æœˆä»˜", balance: 320.50, type: "-" },
            ccb: { name: "å»ºè¡Œä¿¡ç”¨å¡", balance: 1560.25, type: "-" }
        };
        let expenses = [
            { desc: "æˆ¿ç§Ÿ", amount: 1800, date: "2023-12-01" },
            { desc: "ä¿é™©è´¹", amount: 650, date: "2023-12-10" }
        ];
        let installments = [
            { name: "åˆ†æœŸ1", amount: 250, periods: 8 },
            { name: "åˆ†æœŸ2", amount: 350, periods: 6 }
        ];

        function loadData() {
            const savedAccounts = localStorage.getItem('financeAccounts');
            const savedExpenses = localStorage.getItem('financeExpenses');
            const savedInstallments = localStorage.getItem('financeInstallments');

            if (savedAccounts) accounts = JSON.parse(savedAccounts);
            if (savedExpenses) expenses = JSON.parse(savedExpenses);
            if (savedInstallments) installments = JSON.parse(savedInstallments);

            updateDisplay();
            updateInstallmentDisplay();
        }

        function saveData() {
            localStorage.setItem('financeAccounts', JSON.stringify(accounts));
            localStorage.setItem('financeExpenses', JSON.stringify(expenses));
            localStorage.setItem('financeInstallments', JSON.stringify(installments));
        }

        function updateDisplay() {
            const accountsList = document.getElementById('accounts-list');
            accountsList.innerHTML = '';
            let netBalance = 0;
            let totalAssets = 0;
            let totalDebts = 0;
            
            for (const [key, account] of Object.entries(accounts)) {
                const accountElement = document.createElement('div');
                accountElement.className = 'account';
                const value = account.type === '+' ? account.balance : -account.balance;
                netBalance += value;
                if (account.type === '+') totalAssets += account.balance;
                else totalDebts += account.balance;
                
                accountElement.innerHTML = `
                    <span>${account.name}</span>
                    <span class="${account.type === '+' ? 'positive' : 'negative'}">
                        ${account.type}${account.balance.toFixed(2)}
                    </span>`;
                accountsList.appendChild(accountElement);
            }
            
            document.getElementById('net-balance').textContent = netBalance.toFixed(2);
            document.getElementById('total-assets').textContent = totalAssets.toFixed(2);
            document.getElementById('total-debts').textContent = totalDebts.toFixed(2);
            
            // æ›´æ–°è´Ÿå€ºè¿›åº¦æ¡
            const debtProgress = document.getElementById('debt-progress');
            const debtRatio = totalAssets > 0 ? (totalDebts / (totalAssets + totalDebts)) * 100 : 0;
            debtProgress.style.width = `${debtRatio}%`;
            
            const expensesTable = document.querySelector('#expenses-table tbody');
            expensesTable.innerHTML = '';
            expenses.forEach((expense, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${expense.desc}</td>
                    <td class="negative">-${expense.amount.toFixed(2)}</td>
                    <td>${expense.date}</td>
                    <td><button onclick="removeExpense(${index})">åˆ é™¤</button></td>`;
                expensesTable.appendChild(row);
            });

            saveData();
        }

        function updateAccount() {
            const accountId = document.getElementById('account-select').value;
            const amount = parseFloat(document.getElementById('amount').value);
            if (isNaN(amount)) return alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
            accounts[accountId].balance = amount;
            updateDisplay();
        }

        function addToAccount() {
            const accountId = document.getElementById('account-select').value;
            const amount = parseFloat(document.getElementById('amount').value);
            if (isNaN(amount)) return alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
            accounts[accountId].balance += amount;
            updateDisplay();
        }

        function subtractFromAccount() {
            const accountId = document.getElementById('account-select').value;
            const amount = parseFloat(document.getElementById('amount').value);
            if (isNaN(amount)) return alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
            accounts[accountId].balance -= amount;
            updateDisplay();
        }

        function addExpense() {
            const desc = document.getElementById('expense-desc').value.trim();
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;
            if (!desc || isNaN(amount) || !date) return alert('è¯·å¡«å†™å®Œæ•´çš„æ”¯å‡ºä¿¡æ¯');
            expenses.push({ desc, amount, date });
            document.getElementById('expense-desc').value = '';
            document.getElementById('expense-amount').value = '';
            updateDisplay();
        }

        function removeExpense(index) {
            expenses.splice(index, 1);
            updateDisplay();
        }

        function togglePanel(panelId) {
            document.getElementById(panelId).classList.toggle('active');
        }

        function updateInstallmentDisplay() {
            const table = document.querySelector('#installment-table tbody');
            table.innerHTML = '';
            let monthlySum = 0;
            let totalSum = 0;
            
            installments.forEach((item, index) => {
                const total = item.amount * item.periods;
                monthlySum += item.amount;
                totalSum += total;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.amount.toFixed(2)}</td>
                    <td>${item.periods}</td>
                    <td class="negative">-${total.toFixed(2)}</td>
                    <td><button onclick="removeInstallment(${index})">åˆ é™¤</button></td>`;
                table.appendChild(row);
            });
            
            document.getElementById('installment-monthly').textContent = monthlySum.toFixed(2);
            document.getElementById('installment-total').textContent = totalSum.toFixed(2);
        }

        function addInstallment() {
            const name = document.getElementById('installment-name').value;
            const amount = parseFloat(document.getElementById('installment-amount').value);
            const periods = parseInt(document.getElementById('installment-periods').value);
            
            if (!name || isNaN(amount) || isNaN(periods)) 
                return alert('è¯·å¡«å†™å®Œæ•´çš„åˆ†æœŸä¿¡æ¯');
            if (amount <= 0) 
                return alert('æ¯æœˆé‡‘é¢å¿…é¡»å¤§äº0');
            if (periods <= 0) 
                return alert('å‰©ä½™æœŸæ•°å¿…é¡»å¤§äº0');
                
            if (installments.find(i => i.name === name)) 
                return alert('è¯¥åˆ†æœŸåç§°å·²å­˜åœ¨');
            if (installments.length >= 10) 
                return alert('æœ€å¤šæ·»åŠ 10ç¬”åˆ†æœŸ');
                
            installments.push({ name, amount, periods });
            document.getElementById('installment-name').value = '';
            document.getElementById('installment-amount').value = '';
            document.getElementById('installment-periods').value = '';
            updateInstallmentDisplay();
        }

        function removeInstallment(index) {
            installments.splice(index, 1);
            updateInstallmentDisplay();
        }

        // åˆå§‹åŒ–æ—¥æœŸè¾“å…¥æ¡†ä¸ºå½“å‰æ—¥æœŸ
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('expense-date').value = `${year}-${month}-${day}`;
        });

        window.onload = loadData;
    </script>
</body>
</html>

    <button class="back-btn" onclick="goHome()">è¿”å›ä¸»é¡µ</button>
  </div>

  <!-- æ–°å¢: æ¯æ—¥æŠ½å¡çŸ³è®°å½•åŒºåŸŸ -->
  <div id="daily-gems" class="section">
    <h2>æ¯æ—¥æŠ½å¡çŸ³è®°å½•</h2>
    <div class="drop-container">
      <!-- lw æ¸¸æˆåŒºåŸŸ -->
      <h3>æ¸¸æˆ lw</h3>
      <label>æœ‰å¿çŸ³:</label>
      <input type="number" id="lw-paid" min="0" value="0">
      <label>æ— å¿çŸ³:</label>
      <input type="number" id="lw-free" min="0" value="0">
      <button onclick="recordGems('lw')">è®°å½•</button>
      <div id="lw-records"></div>
      <button onclick="generateChart('lw')">ç”Ÿæˆå›¾</button>
      <canvas id="lw-chart" width="400" height="200"></canvas>

      <!-- ep æ¸¸æˆåŒºåŸŸ -->
      <h3>æ¸¸æˆ ep</h3>
      <label>æœ‰å¿çŸ³:</label>
      <input type="number" id="ep-paid" min="0" value="0">
      <label>æ— å¿çŸ³:</label>
      <input type="number" id="ep-free" min="0" value="0">
      <button onclick="recordGems('ep')">è®°å½•</button>
      <div id="ep-records"></div>
      <button onclick="generateChart('ep')">ç”Ÿæˆå›¾</button>
      <canvas id="ep-chart" width="400" height="200"></canvas>

      <!-- åˆ é™¤è®°å½• -->
      <h3>åˆ é™¤è®°å½•</h3>
      <label>æ—¥æœŸ (YYYY-MM-DD):</label>
      <input type="text" id="delete-date" placeholder="2023-09-07">
      <label>æ¸¸æˆ:</label>
      <select id="delete-game">
        <option value="lw">lw</option>
        <option value="ep">ep</option>
      </select>
      <button onclick="deleteRecord()">åˆ é™¤</button>
    </div>
    <button class="back-btn" onclick="goHome()">è¿”å›ä¸»é¡µ</button>
  </div>

  <script>
    // å·¥å…·ç®±æ¡†æ¶å‡½æ•°
    function showSection(id) {
      document.querySelectorAll('.section').forEach(div => div.style.display = 'none');
      const section = document.getElementById(id);
      section.style.display = 'block';
      
      // ç‰¹æ®Šå¤„ç†æ‰ç‡è®¡ç®—å™¨çš„åˆå§‹åŒ–
      if(id === 'drop') {
        updateCharInputs();
      }
      // åˆå§‹åŒ–æ¯æ—¥æŠ½å¡çŸ³è®°å½•
      if(id === 'daily-gems') {
        loadGemsRecords('lw');
        loadGemsRecords('ep');
      }
      // åˆå§‹åŒ–æ±‡ç‡è®¡ç®—å™¨ï¼ˆç¡®ä¿åŠ è½½ï¼‰
      if(id === 'currency') {
        if (typeof loadExchangeRate === 'function') loadExchangeRate();
      }
    }
    
    function goHome() {
      document.querySelectorAll('.section').forEach(div => div.style.display = 'none');
    }

    // æ‰ç‡è®¡ç®—å™¨å‡½æ•°
    function updateCharInputs() {
      const count = parseInt(document.getElementById('charCount').value);
      const container = document.getElementById('charInputs');
      container.innerHTML = '';
      
      for (let i = 1; i <= count; i++) {
        const div = document.createElement('div');
        div.className = 'char-input';
        div.innerHTML = `
          <label for="char${i}">è§’è‰²${i}å‘½è¿å€¼ (5-100):</label>
          <input type="number" id="char${i}" min="5" max="100" value="50">
        `;
        container.appendChild(div);
      }
    }
    
    function calculateDropRate() {
      const charCount = parseInt(document.getElementById('charCount').value);
      const targetA = parseInt(document.getElementById('targetA').value);
      const targetB = parseInt(document.getElementById('targetB').value);
      
      let chars = [];
      for (let i = 1; i <= charCount; i++) {
        const fate = parseInt(document.getElementById(`char${i}`).value);
        chars.push(fate);
      }
      
      const aRate = 0.003;
      let bRateA = 0;
      let bRateB = 0;
      
      chars.forEach(fate => {
        const rateMultiplier = fate === 100 ? 2 : fate / 100;
        bRateA += rateMultiplier * 0.00038;
        bRateB += rateMultiplier * 0.00033;
      });
      
      const totalARate = 1 - (1 - aRate) * (1 - bRateA);
      const totalBRate = bRateB;
      const battlesForA = targetA / totalARate;
      const battlesForB = targetB / totalBRate;
      const totalBattles = Math.max(battlesForA, battlesForB);
      const staminaPerBattle = charCount * 5;
      const totalStamina = totalBattles * staminaPerBattle;
      
      const resultDiv = document.getElementById('dropResult');
      const detailsDiv = document.getElementById('resultDetails');
      
      detailsDiv.innerHTML = `
        <table class="drop-table">
          <tr><th>æœºåˆ¶</th><th>æ‰ç‡</th><th>æœŸæœ›1ä¸ªæ‰€éœ€å±€æ•°</th><th>æ¶ˆè€—ä½“åŠ›</th></tr>
          <tr>
            <td>Aé“å…·(aæœºåˆ¶)</td>
            <td>${(aRate * 100).toFixed(4)}%</td>
            <td>${Math.ceil(1 / aRate)}</td>
            <td>${Math.ceil(1 / aRate) * staminaPerBattle}</td>
          </tr>
          <tr>
            <td>Aé“å…·(bæœºåˆ¶æ€»å’Œ)</td>
            <td>${(bRateA * 100).toFixed(6)}%</td>
            <td>${Math.ceil(1 / bRateA)}</td>
            <td>${Math.ceil(1 / bRateA) * staminaPerBattle}</td>
          </tr>
          <tr>
            <td>Bé“å…·(bæœºåˆ¶æ€»å’Œ)</td>
            <td>${(bRateB * 100).toFixed(6)}%</td>
            <td>${Math.ceil(1 / bRateB)}</td>
            <td>${Math.ceil(1 / bRateB) * staminaPerBattle}</td>
          </tr>
          <tr>
            <td>ç»¼åˆAé“å…·(a+bæœºåˆ¶)</td>
            <td>${(totalARate * 100).toFixed(6)}%</td>
            <td>${Math.ceil(1 / totalARate)}</td>
            <td>${Math.ceil(1 / totalARate) * staminaPerBattle}</td>
          </tr>
        </table>
        <h3>ç›®æ ‡æ‰è½: ${targetA}ä¸ªA + ${targetB}ä¸ªB</h3>
        <p>é¢„è®¡éœ€è¦: ${Math.ceil(totalBattles)} å±€</p>
        <p>é¢„è®¡æ¶ˆè€—: ${Math.ceil(totalStamina)} ä½“åŠ›</p>
      `;
      
      resultDiv.classList.remove('drop-hidden');
    }

    // åˆå§‹åŒ–æ‰ç‡è®¡ç®—å™¨çš„è¾“å…¥ç›‘å¬
    document.getElementById('charCount').addEventListener('change', updateCharInputs);

    // æ–°å¢: æ¯æ—¥æŠ½å¡çŸ³è®°å½•å‡½æ•°
    function recordGems(game) {
      const paidId = `${game}-paid`;
      const freeId = `${game}-free`;
      const paid = parseInt(document.getElementById(paidId).value);
      const free = parseInt(document.getElementById(freeId).value);
      if (isNaN(paid) || isNaN(free)) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„çŸ³å¤´æ•°é‡');
        return;
      }
      const date = new Date().toISOString().split('T')[0];
      const recordsKey = `${game}Records`;
      let records = JSON.parse(localStorage.getItem(recordsKey)) || [];
      const lastRecord = records.length > 0 ? records[records.length - 1] : { paid: 0, free: 0 };
      const paidDiff = paid - lastRecord.paid;
      const freeDiff = free - lastRecord.free;
      records.push({ date, paid, free, paidDiff, freeDiff });
      localStorage.setItem(recordsKey, JSON.stringify(records));
      loadGemsRecords(game);
    }

    function loadGemsRecords(game) {
      const recordsKey = `${game}Records`;
      const records = JSON.parse(localStorage.getItem(recordsKey)) || [];
      const recordsDiv = document.getElementById(`${game}-records`);
      recordsDiv.innerHTML = '<h4>è®°å½•:</h4>';
      records.forEach(rec => {
        recordsDiv.innerHTML += `<p>${rec.date}: æœ‰å¿ ${rec.paid} (Î”${rec.paidDiff}), æ— å¿ ${rec.free} (Î”${rec.freeDiff})</p>`;
      });
    }

    function generateChart(game) {
      const recordsKey = `${game}Records`;
      const records = JSON.parse(localStorage.getItem(recordsKey)) || [];
      if (records.length === 0) {
        alert('æ²¡æœ‰è®°å½•ï¼Œæ— æ³•ç”Ÿæˆå›¾è¡¨');
        return;
      }
      records.sort((a, b) => new Date(a.date) - new Date(b.date)); // æŒ‰æ—¥æœŸæ’åº
      const canvas = document.getElementById(`${game}-chart`);
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const barWidth = 20;
      const spacing = 40;
      const maxY = Math.max(...records.map(r => Math.max(r.paid, r.free))) * 1.1;
      const scaleY = canvas.height / maxY;

      // ç»˜åˆ¶æŸ±çŠ¶å›¾
      records.forEach((rec, i) => {
        const x = i * spacing + 50;
        // æœ‰å¿æŸ± (è“è‰²)
        ctx.fillStyle = 'blue';
        ctx.fillRect(x - barWidth / 2, canvas.height - rec.paid * scaleY, barWidth / 2, rec.paid * scaleY);
        // æ— å¿æŸ± (ç»¿è‰²)
        ctx.fillStyle = 'green';
        ctx.fillRect(x, canvas.height - rec.free * scaleY, barWidth / 2, rec.free * scaleY);
        // xè½´æ ‡ç­¾
        ctx.fillStyle = 'black';
        ctx.fillText(rec.date, x - 20, canvas.height - 5);
      });

      // ç»˜åˆ¶æŠ˜çº¿å›¾
      ctx.beginPath();
      ctx.strokeStyle = 'blue';
      ctx.lineWidth = 2;
      records.forEach((rec, i) => {
        const x = i * spacing + 50;
        const y = canvas.height - rec.paid * scaleY;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();

      ctx.beginPath();
      ctx.strokeStyle = 'green';
      records.forEach((rec, i) => {
        const x = i * spacing + 50;
        const y = canvas.height - rec.free * scaleY;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();
    }

    function deleteRecord() {
      const date = document.getElementById('delete-date').value;
      const game = document.getElementById('delete-game').value;
      const recordsKey = `${game}Records`;
      let records = JSON.parse(localStorage.getItem(recordsKey)) || [];
      records = records.filter(rec => rec.date !== date);
      localStorage.setItem(recordsKey, JSON.stringify(records));
      loadGemsRecords(game);
    }
  </script>
</body>
</html>
